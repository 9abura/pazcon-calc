<script>
  const baseTime = [18.0, 23.0, 30.0, 39.0, 51.0, 66.0, 88.0, 115.0, 150.0, 197.0, 260.0];
  const riskaReduction = [3,4.5,6,9,12,18.75,24,26,28];
  const powerList = [4,6,8,12,15,20,25,33,45,60,80];
  const eventPoints = [5,10,15,22,30,40,55,70,85,110,120];

  const baseCost = {
    infantry: [[3624,562,0,0],[5431,1312,0,0],[7496,2437,0,0],[10387,3937,0,0],[13518,5062,1125,0],[18225,7875,1575,0],[23400,10875,2250,0],[31200,15750,3150,0],[42112,22500,4500,0],[55800,31500,6300,630],[88500,47250,9450,945]],
    cavalry:  [[3624,562,0,0],[5431,1312,0,0],[7496,2437,0,0],[10387,3937,0,0],[13518,5062,1125,0],[18225,7875,1575,0],[23400,10875,2250,0],[31200,15750,3150,0],[42112,22500,4500,0],[55800,31500,6300,630],[88500,47250,9450,945]],
    archer:   [[3624,562,0,0],[5431,1312,0,0],[7496,2437,0,0],[10387,3937,0,0],[13518,5062,1125,0],[18225,7875,1575,0],[23400,10875,2250,0],[31200,15750,3150,0],[42112,22500,4500,0],[55800,31500,6300,630],[88500,47250,9450,945]],
    catapult: [[3624,562,0,0],[5431,1312,0,0],[7496,2437,0,0],[10387,3937,0,0],[13518,5062,1125,0],[18225,7875,1575,0],[23400,10875,2250,0],[31200,15750,3150,0],[42112,22500,4500,0],[68400,38250,8100,810],[99000,54000,10800,1080]]
  };

  function updateLabel() {
    const mode = document.getElementById("mode").value;
    const label = document.getElementById("dynamicLabel");
    if (mode === "count") label.textContent = "è¨“ç·´ã—ãŸã„äººæ•°:";
    if (mode === "power") label.textContent = "ç²å¾—ã—ãŸã„æˆ¦åŠ›:";
    if (mode === "points") label.textContent = "ç²å¾—ã—ãŸã„ã‚¤ãƒ™ãƒ³ãƒˆãƒã‚¤ãƒ³ãƒˆ:";
  }

  function calculate() {
    const t = parseInt(document.getElementById("tLevel").value);
    const type = document.getElementById("type").value;
    const mode = document.getElementById("mode").value;
    const input = document.getElementById("inputValue");
    const buffInput = document.getElementById("speedBuff");

    let hasError = false;
    [input, buffInput].forEach(el => {
      if (!el.value) {
        el.classList.add("error");
        hasError = true;
      } else {
        el.classList.remove("error");
      }
    });
    if (hasError) return;

    const raw = parseFloat(input.value);
    const buff = parseFloat(buffInput.value);
    const rLv = document.getElementById("riskaLevel").value;
    const skill = document.getElementById("skill25").checked;
    const manual = parseFloat(document.getElementById("manualReduction").value);
    const unit = document.getElementById("timeUnit").value;

    let count;
    if (mode === "count") count = raw;
    if (mode === "power") count = raw / powerList[t - 1];
    if (mode === "points") count = raw / eventPoints[t - 1];

    const reduction = !isNaN(manual)
      ? manual
      : (rLv === "none" ? 0 : riskaReduction[parseInt(rLv)]) + (skill ? 25 : 0);

    const timeSec = count * baseTime[t - 1] * 100 / (100 + buff);
    const d = Math.floor(timeSec / 86400);
    const h = Math.floor((timeSec % 86400) / 3600);
    const m = Math.floor((timeSec % 3600) / 60);

    // ğŸš© ä¿®æ­£ç‚¹ï¼: ã‚³ã‚¹ãƒˆã‚’10äººå˜ä½ â†’ 1äººå˜ä½ â†’ å¿…è¦äººæ•°åˆ†ã§è¨ˆç®—
    const cost = baseCost[type][t - 1];
    const final = cost.map(v => Math.round((v / 10) * count * (1 - reduction / 100)));

    let timeStr = "";
    if (unit === "day") timeStr = `${d}æ—¥ ${h}æ™‚é–“ ${m}åˆ†`;
    if (unit === "hour") timeStr = `${(timeSec / 3600).toFixed(2)} æ™‚é–“`;
    if (unit === "minute") timeStr = `${(timeSec / 60).toFixed(0)} åˆ†`;

    document.getElementById("output").innerHTML = `
      <b>è¨“ç·´æ™‚é–“ï¼š</b>${timeStr}<br><br>
      <b>è»½æ¸›å¾Œã®è¨“ç·´ã‚³ã‚¹ãƒˆï¼ˆ${reduction.toFixed(2)}% æ¸›ï¼‰</b><br>
      ãƒ»é£Ÿæ–™ï¼š${final[0].toLocaleString()}<br>
      ãƒ»æœ¨æï¼š${final[1].toLocaleString()}<br>
      ãƒ»é‰„ï¼š${final[2].toLocaleString()}<br>
      ãƒ»é‡‘è²¨ï¼š${final[3].toLocaleString()}
    `;
  }
</script>
