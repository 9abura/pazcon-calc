<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>パズコン兵士訓練計算ツール</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Noto Sans JP', sans-serif;
      background: #fef7ed;
      margin: 0; padding: 20px;
      color: #333;
    }
    h1 { text-align: center; color: #2a2a2a; margin-bottom: 1em; }
    label { display: block; margin-bottom: 12px; font-weight: 600; }
    input, select {
      width: 100%; padding: 10px;
      font-size: 1em; margin-top: 4px;
      border: 1px solid #ccc;
      border-radius: 6px; background-color: #fff;
    }
    input[type="checkbox"] {
      width: auto; margin-right: 6px;
    }
    button {
      background: #0077cc; color: white;
      padding: 12px 24px;
      font-size: 1em;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 20px;
    }
    .result {
      margin-top: 30px; padding: 20px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      font-size: 1.05em;
    }
    .inline-label {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .info-icon {
      background-color: #0077cc;
      color: white;
      font-weight: bold;
      border-radius: 50%;
      width: 20px; height: 20px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 14px;
    }
    @media (min-width: 600px) {
      body { max-width: 600px; margin: auto; }
    }
    .error {
      border-color: red;
    }
  </style>
</head>
<body>
  <h1>パズコン兵士訓練計算ツール</h1>

<label>Tレベル（T1〜T11）:
  <select id="tLevel">
    <option value="1">T1</option>
    <option value="2">T2</option>
    <option value="3">T3</option>
    <option value="4">T4</option>
    <option value="5">T5</option>
    <option value="6">T6</option>
    <option value="7">T7</option>
    <option value="8">T8</option>
    <option value="9">T9</option>
    <option value="10">T10</option>
    <option value="11">T11</option>
  </select>
</label>

  <label>兵種を選択:
    <select id="type">
      <option value="infantry">歩兵</option>
      <option value="cavalry">騎兵</option>
      <option value="archer">弓兵</option>
      <option value="catapult">カタパルト</option>
    </select>
  </label>

  <label>訓練人数 or 戦力 or ポイント:
    <select id="mode" onchange="updateLabel()">
      <option value="count">訓練人数</option>
      <option value="power">獲得したい戦力</option>
      <option value="points">獲得したいイベントポイント</option>
    </select>
  </label>

  <label id="dynamicLabel">訓練したい人数:</label>
  <input type="number" id="inputValue" value="">

  <label>訓練速度バフ（％）:
    <input type="number" id="speedBuff" value="">
  </label>

  <label class="inline-label">
    リスカの+値（Lv.131解放済とする）：
    <div class="info-icon" onclick="alert('※ +5以上の軽減率は昇進級後の値')">!</div>
  </label>
  <select id="riskaLevel">
    <option value="none">所持していない</option>
    <option value="0">+0</option>
    <option value="1">+1</option>
    <option value="2">+2</option>
    <option value="3">+3</option>
    <option value="4">+4</option>
    <option value="5">+5</option>
    <option value="6">+6</option>
    <option value="7">+7</option>
    <option value="8">+8</option>
  </select>

  <label><input type="checkbox" id="skill25"> スキル（−25%）をONにする</label>

  <label>コスト軽減率を手入力（任意）:
    <input type="number" id="manualReduction" placeholder="例：28">
  </label>

  <label>時間表示単位:
    <select id="timeUnit">
      <option value="day">日</option>
      <option value="hour">時間</option>
      <option value="minute">分</option>
    </select>
  </label>

  <button onclick="calculate()">計算する</button>

  <div class="result" id="output">▼ここに訓練時間と資源コストが表示されます</div>

  <script>
    const baseTime = [18,23,30,39,51,66,81,99,120,150,260];
    const riskaReduction = [3,4.5,6,9,12,18.75,24,26,28];
    const powerList = [4,6,8,12,15,20,25,33,45,60,80];
    const eventPoints = [5,10,15,22,30,40,55,70,85,110,120];

    const baseCost = {
  infantry: [
    [36242, 5625, 0, 0],       // T1
    [54313, 13125, 0, 0],      // T2
    [74962, 24375, 0, 0],      // T3
    [103875, 39375, 0, 0],     // T4
    [135187, 50625, 11250, 0], // T5
    [182250, 78750, 15750, 0], // T6
    [234000, 108750, 22500, 0],// T7
    [312000, 157500, 31500, 0],// T8
    [421125, 225000, 45000, 0],// T9
    [558000, 315000, 63000, 6300], // T10
    [885000, 472500, 94500, 9450]  // T11
  ],
  cavalry: [
    [36242, 5625, 0, 0],
    [54313, 13125, 0, 0],
    [74962, 24375, 0, 0],
    [103875, 39375, 0, 0],
    [135187, 50625, 11250, 0],
    [182250, 78750, 15750, 0],
    [234000, 108750, 22500, 0],
    [312000, 157500, 31500, 0],
    [421125, 225000, 45000, 0],
    [558000, 315000, 63000, 6300],
    [885000, 472500, 94500, 9450]
  ],
  archer: [
    [36242, 5625, 0, 0],
    [54313, 13125, 0, 0],
    [74962, 24375, 0, 0],
    [103875, 39375, 0, 0],
    [135187, 50625, 11250, 0],
    [182250, 78750, 15750, 0],
    [234000, 108750, 22500, 0],
    [312000, 157500, 31500, 0],
    [421125, 225000, 45000, 0],
    [558000, 315000, 63000, 6300],
    [885000, 472500, 94500, 9450]
  ],
  catapult: [
    [36242, 5625, 0, 0],
    [54313, 13125, 0, 0],
    [74962, 24375, 0, 0],
    [103875, 39375, 0, 0],
    [135187, 50625, 11250, 0],
    [182250, 78750, 15750, 0],
    [234000, 108750, 22500, 0],
    [312000, 157500, 31500, 0],
    [421125, 225000, 45000, 0],
    [684000, 382500, 81000, 8100], // T10
    [990000, 540000, 108000, 10800] // T11
  ]
};

    function updateLabel() {
      const mode = document.getElementById("mode").value;
      const label = document.getElementById("dynamicLabel");
      if (mode === "count") label.textContent = "訓練したい人数:";
      if (mode === "power") label.textContent = "獲得したい戦力:";
      if (mode === "points") label.textContent = "獲得したいイベントポイント:";
    }

    function calculate() {
      const t = parseInt(document.getElementById("tLevel").value);
      const type = document.getElementById("type").value;
      const mode = document.getElementById("mode").value;
      const input = document.getElementById("inputValue");
      const buffInput = document.getElementById("speedBuff");

      let hasError = false;
      [input, buffInput].forEach(el => {
        if (!el.value) {
          el.classList.add("error");
          hasError = true;
        } else {
          el.classList.remove("error");
        }
      });
      if (hasError) return;

      const raw = parseFloat(input.value);
      const buff = parseFloat(buffInput.value);
      const rLv = document.getElementById("riskaLevel").value;
      const skill = document.getElementById("skill25").checked;
      const manual = parseFloat(document.getElementById("manualReduction").value);
      const unit = document.getElementById("timeUnit").value;

      let count;
      if (mode === "count") count = raw;
      if (mode === "power") count = raw / powerList[t - 1];
      if (mode === "points") count = raw / eventPoints[t - 1];

      const reduction = !isNaN(manual)
        ? manual
        : (rLv === "none" ? 0 : riskaReduction[parseInt(rLv)]) + (skill ? 25 : 0);

      const timeSec = count * baseTime[t - 1] * 100 / (100 + buff);
      const d = Math.floor(timeSec / 86400);
      const h = Math.floor((timeSec % 86400) / 3600);
      const m = Math.floor((timeSec % 3600) / 60);

      const cost = baseCost[type][t - 1];
      const final = cost.map(v => Math.round(v * count * (1 - reduction / 100)));

      let timeStr = "";
      if (unit === "day") timeStr = `${d}日 ${h}時間 ${m}分`;
      if (unit === "hour") timeStr = `${(timeSec / 3600).toFixed(2)} 時間`;
      if (unit === "minute") timeStr = `${(timeSec / 60).toFixed(0)} 分`;

      document.getElementById("output").innerHTML = `
        <b>訓練時間：</b>${timeStr}<br><br>
        <b>軽減後の訓練コスト（${reduction.toFixed(2)}% 減）</b><br>
        ・食料：${final[0].toLocaleString()}<br>
        ・木材：${final[1].toLocaleString()}<br>
        ・鉄：${final[2].toLocaleString()}<br>
        ・金貨：${final[3].toLocaleString()}
      `;
    }
  </script>
</body>
</html>
